<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Mengubah judul tab browser -->
    <title>PT. Sahabat Intim Plasindo</title>
    <!-- Memuat Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Konfigurasi Tailwind untuk font Inter dan CSS Kustom -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; /* Mencegah scroll horizontal */
        }
        /* Kelas transisi kustom untuk konten halaman */
        .page-content-transition {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* CSS kustom untuk responsivitas tabel */
        .table-container-responsive {
            overflow-x: auto; /* Memungkinkan scroll horizontal pada tabel di mobile */
            -webkit-overflow-scrolling: touch;
        }
        .table-container-responsive th, .table-container-responsive td {
            white-space: nowrap; /* Mencegah sel tabel pecah */
            padding: 12px 16px;
        }

        /* --- PENGELOLAAN VISIBILITAS HEADER BERBASIS STATE --- */
        /* State default: Tampilan publik */
        #adminLogoutButton { display: none; }

        /* State admin: Sembunyikan navigasi publik & burger, tampilkan tombol logout */
        /* REVISI: Tambahkan user-view untuk menyembunyikan burger di menu pengguna */
        body[data-app-state="admin-view"] #desktopNav,
        body[data-app-state="admin-view"] #burgerContainer,
        body[data-app-state="user-view"] #burgerContainer,
        body[data-app-state="user-view"] #desktopNav {
            display: none;
        }

        body[data-app-state="admin-view"] #adminLogoutButton {
            display: block;
        }

        /* State pengguna: Sembunyikan navigasi desktop, tampilkan burger */
        /* BARIS INI TIDAK DIPERLUKAN LAGI KARENA DIGABUNGKAN DI ATAS */
        /* body[data-app-state="user-view"] #desktopNav { display: none; } */
        
        /* Styling untuk input tanggal agar terlihat konsisten */
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            opacity: 0.6;
            filter: invert(0.5);
        }
        
        /* Custom class untuk meratakan konten di kolom kanan */
        .data-label {
            font-weight: 500; /* Medium */
            color: #4b5563; /* gray-700 */
        }
        .data-value {
            font-weight: 600;
            color: #1f2937; /* gray-900 */
            text-align: right;
        }
        .detail-row {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Membagi menjadi dua kolom utama */
            gap: 0; /* Menghilangkan gap agar terlihat seperti tabel */
            border-bottom: 1px dashed #e5e7eb; /* Garis pemisah antar baris */
            padding-top: 8px;
            padding-bottom: 8px;
        }
        .detail-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .detail-label {
            font-weight: 500;
            color: #4b5563; /* gray-600 */
        }
        .detail-value {
            font-weight: 600;
            color: #1f2937; /* gray-900 */
            text-align: right;
        }
        .detail-row-full {
             /* Untuk alamat atau kolom penuh */
             display: block;
             border-bottom: 1px dashed #e5e7eb;
             padding-top: 8px;
             padding-bottom: 8px;
        }

        /* Style untuk tombol kembali (Teks Rata Kiri - Tanpa Background/Shadow) */
        .back-button-flow {
            padding: 0; /* Hapus padding */
            background-color: transparent; /* Hilangkan background */
            color: #2563eb; /* Biru (blue-600) agar terlihat seperti tautan */
            border-radius: 0; /* Hilangkan border radius */
            font-weight: 600;
            transition: color 0.2s;
            display: inline-block;
            box-shadow: none; /* Hilangkan bayangan */
            margin-top: 16px; 
            cursor: pointer; /* Pastikan kursor berubah saat dihover */
        }
        .back-button-flow:hover {
            background-color: transparent; 
            color: #1d4ed8; /* Biru gelap (blue-700) saat hover */
        }
        
        /* Gaya kustom untuk Carousel */
        .carousel-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .carousel-item.active {
            opacity: 1;
            z-index: 10;
        }
        .carousel-nav-button {
            z-index: 20;
            transition: background-color 0.3s;
        }
        
        /* Gaya untuk Logo Placeholder - SHINPO */
        /* Kelas ini dihapus karena diganti IMG */
        
        /* Gaya untuk Teks Deskripsi Logo */
        .logo-text {
            font-size: 0.8rem; /* Ukuran lebih kecil dari SHINPO Logo */
            line-height: 1;
            color: #1f2937; /* Gray-900 */
            font-weight: 500;
        }
        /* Kelas baru untuk memastikan gambar logo sejajar dengan teks */
        .logo-img {
            height: 40px; /* Tinggi logo agar sejajar dengan dua baris teks */
            width: auto;
        }
        
        /* CSS Tambahan: Untuk Full-width Carousel */
        /* Header memiliki tinggi sekitar 60px. Kita perlu menggeser carousel ke bawah sebesar itu */
        #mainCarouselContainer {
            position: relative;
            z-index: 20; /* Lebih rendah dari header (z-50) */
            margin-top: 64px; /* Memberi ruang di bawah fixed header */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* Shadow agar terpisah dari hero */
        }
        /* Style untuk modal detail (agar tampilan detail seperti tabel) */
        .detail-row {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Membagi menjadi dua kolom utama */
            gap: 0; /* Menghilangkan gap agar terlihat seperti tabel */
            border-bottom: 1px dashed #e5e7eb; /* Garis pemisah antar baris */
            padding-top: 8px;
            padding-bottom: 8px;
        }
        .detail-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        .detail-label {
            font-weight: 500;
            color: #4b5563; /* gray-600 */
        }
        .detail-value {
            font-weight: 600;
            color: #1f2937; /* gray-900 */
            text-align: right;
        }
        .detail-row-full {
             /* Untuk alamat atau kolom penuh */
             display: block;
             border-bottom: 1px dashed #e5e7eb;
             padding-top: 8px;
             padding-bottom: 8px;
        }

    </style>
</head>
<body class="bg-gray-50" data-app-state="public-view">

    <!-- Kontainer Utama -->
    <div class="min-h-screen relative flex flex-col justify-center pb-16">
        
        <!-- Navigasi Bar / Header (Fixed di atas) -->
        <header id="appHeader" class="fixed top-0 left-0 right-0 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4 z-50 bg-gray-50 shadow-md">
            <nav class="flex items-center justify-between w-full">
                <!-- Logo SHINPO (KIRI - SELALU TERLIHAT) -->
                <div class="flex items-center space-x-2" onclick="showPage('mainHero')" style="cursor: pointer;">
                    
                    <!-- Logo Utama (Ganti dengan tag IMG untuk URL) -->
                    <img 
                        id="mainLogoImage"
                        src="https://www.shinpo.co.id/wp-content/uploads/2019/09/shinpo-logo-mobile.png" 
                        alt="Logo SHINPO" 
                        class="logo-img"
                    />

                    <!-- Teks Deskripsi (Plastic Houseware...) - DIHAPUS -->
                    
                </div>

                <!-- Kontainer Kanan (Menu Navigasi Desktop & Burger / Logout) -->
                <div class="flex items-center space-x-3 sm:space-x-4">
                    
                    <!-- MENU NAVIGASI DESKTOP (DISPLAI HANYA DI HALAMAN PUBLIK) -->
                    <div id="desktopNav" class="hidden sm:flex space-x-6 text-lg font-medium">
                        <a href="#" onclick="showPage('mainHero')" class="text-gray-800 hover:text-red-500 transition duration-150">Home</a>
                        <a href="#" onclick="showPage('aboutPage')" class="text-gray-800 hover:text-red-500 transition duration-150">About</a>
                        <a href="#" onclick="showPage('contactPage')" class="text-gray-800 hover:text-red-500 transition duration-150">Contact</a>
                    </div>
                    
                    <!-- Tombol Logout Admin (HANYA TERLIHAT DI DASHBOARD ADMIN) -->
                    <button    
                        id="adminLogoutButton"    
                        onclick="showLogoutConfirmation()"    
                        class="hidden bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition duration-200 focus:outline-none"
                    >
                        Logout
                    </button>

                    <!-- Kontainer untuk Tombol Burger dan Menu -->
                    <div id="burgerContainer" class="relative">
                        <!-- Tombol Burger Menu (KANAN) -->
                        <button    
                            id="menuButton"
                            class="p-2 text-blue-900 border border-blue-900 rounded-lg hover:bg-blue-100 transition duration-150"
                            aria-label="Toggle Menu"
                            aria-expanded="false"
                        >
                            <!-- Ikon SVG Hamburger (Menu) -->
                            <svg id="iconMenu" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                            </svg>
                            <!-- Ikon SVG Tutup (X) - Tersembunyi secara default -->
                            <svg id="iconClose" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>

                        <!-- OPSI MENU (TERSEMBUNYI SECARA DEFAULT) -->
                        <div id="navMenu" class="hidden absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-xl py-2 z-20">
                            <!-- Tombol Pengguna (Satu Baris) - Menuju User Menu -->
                            <a href="#" onclick="showPage('userMenu')" class="block mx-2 my-1 px-3 py-2 bg-red-500 text-center text-white text-lg font-bold rounded-lg hover:bg-red-600 transition duration-300 shadow-md">
                                Pengguna
                            </a>
                            <div class="border-t border-gray-200 my-1"></div>
                            <!-- Tombol Admin (Satu Baris) - Menuju Admin Menu -->
                            <a href="#" onclick="showPage('adminLogin')" class="block mx-2 my-1 px-3 py-2 bg-red-500 text-center text-white text-lg font-bold rounded-lg hover:bg-red-600 transition duration-300 shadow-md">
                                Admin
                            </a>
                        </div>
                    </div>
                </div>
                
            </nav>
        </header>
        
        <!-- FULL-WIDTH CAROUSEL CONTAINER (BARU) -->
        <!-- Memastikan carousel di luar batasan max-w dari mainHero -->
        <div id="mainCarouselContainer" class="w-full">
             <!-- CAROUSEL BANNER (16:9 aspect ratio) -->
            <div id="mainCarousel" class="relative w-full overflow-hidden shadow-2xl" style="padding-top: 56.25%;"> <!-- 16:9 Aspect Ratio -->
                
                <!-- Item Carousel 1: Wadah Plastik -->
                <div class="carousel-item active">
                    <img src="https://i.ytimg.com/vi/FZOv0lTINTY/maxresdefault.jpg" alt="Wadah Penyimpanan Plastik" class="absolute inset-0 w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-30 flex flex-col items-center justify-center p-8 text-center">
                        <h2 class="text-3xl sm:text-5xl font-extrabold text-white">INOVASI PENYIMPANAN</h2>
                        <p class="text-lg sm:text-xl text-gray-200 mt-2">Wadah Plastik Berkualitas Tinggi, Tahan Banting</p>
                    </div>
                </div>

                <!-- Item Carousel 2: Furnitur Plastik -->
                <div class="carousel-item">
                    <img src="https://lh5.googleusercontent.com/p/AF1QipOF2dgy1a188H9MhQvKG10RKxOE9uhAL51TxYn2=w483-h240-k-no" alt="Kursi dan Meja Plastik" class="absolute inset-0 w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-30 flex flex-col items-center justify-center p-8 text-center">
                        <h2 class="text-3xl sm:text-5xl font-extrabold text-white">FURNITURE TAHAN LAMA</h2>
                        <p class="text-lg sm:text-xl text-gray-200 mt-2">Desain Modern untuk Rumah dan Industri</p>
                    </div>
                </div>

                <!-- Item Carousel 3: Produk Rumah Tangga -->
                <div class="carousel-item">
                    <img src="https://down-id.img.susercontent.com/file/id-11134207-7rasm-m2lwarhw5cqs26" alt="Ember dan Peralatan Rumah Tangga" class="absolute inset-0 w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-30 flex flex-col items-center justify-center p-8 text-center">
                        <h2 class="text-3xl sm:text-5xl font-extrabold text-white">PELOPOR KUALITAS</h2>
                        <p class="text-lg sm:text-xl text-gray-200 mt-2">Produk Rumah Tangga Terpercaya Sejak 1982</p>
                    </div>
                </div>
                
            </div>
            <!-- END CAROUSEL BANNER -->
        </div>

        <!-- 1. HALAMAN UTAMA (HERO) -->
        <!-- Menghapus padding-top dan memindahkan konten di bawah carousel ke sini -->
        <main id="mainHero" class="page-content page-content-transition max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 opacity-100">
            <div class="flex flex-col items-center justify-center pt-8">    
                
                <!-- Teks Hero -->
                <div class="w-full text-center mb-12 lg:mb-0">
                    <h1 class="text-xl sm:text-4xl lg:text-5xl font-extrabold leading-tight text-red-500 mb-3">
                        Solusi Plastik Terbaik untuk Kebutuhan Rumah Tangga dan Industri Anda
                    </h1>
                    <p class="text-md sm:text-lg font-medium text-blue-900 opacity-90 mb-8">
                        PT. Sahabat Intim Plasindo, Inovasi dalam Setiap Produk Plastik.
                    </p>
                </div>
            </div>
        </main>

        <!-- 2. HALAMAN MENU PENGGUNA -->
        <div id="userMenu" class="page-content page-content-transition hidden opacity-0 max-w-xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6"> 
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <h2 class="text-4xl font-extrabold text-blue-900 mb-6 text-center">Selamat Datang, Pengguna!</h2>
            <p class="text-lg text-gray-600 mb-10 text-center">Silakan pilih menu di bawah ini untuk mengakses layanan PT. Sahabat Intim Plasindo.</p>
            
            <div class="space-y-4 w-full">
                <!-- Opsi 1: Biodata Karyawan (Hijau - Serasi dengan Kelola Karyawan Baru) -->
                <a href="#" onclick="showPage('biodataPage')" class="block w-full p-3 bg-green-50 text-green-800 text-lg font-medium text-center rounded-lg shadow-md hover:bg-green-100 hover:shadow-lg transition duration-150 border border-green-200">
                    Biodata Karyawan
                </a>
                <!-- Opsi 2: Permasalahan Karyawan (Kuning - Serasi dengan Update Permasalahan Karyawan) -->
                <a href="#" onclick="showPage('employeeListPage')" class="block w-full p-3 bg-yellow-50 text-yellow-800 text-lg font-medium text-center rounded-lg shadow-md hover:bg-yellow-100 hover:shadow-lg transition duration-150 border border-yellow-200">
                    Permasalahan Karyawan
                </a>
                <!-- Opsi 3: Permasalahan Produksi (Biru - Serasi dengan Laporan Permasalahan Produksi) -->
                <a href="#" onclick="showPage('userProductionPage')" class="block w-full p-3 bg-blue-50 text-blue-800 text-lg font-medium text-center rounded-lg shadow-md hover:bg-blue-100 hover:shadow-lg transition duration-150 border border-blue-200">
                    Permasalahan Produksi
                </a>
            </div>

            <!-- Tombol Kembali ke Hero (MENGHAPUS TOMBOL INI) -->
            <!-- <button onclick="showPage('mainHero')" class="mt-8 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Beranda
            </button> -->
        </div>

        <!-- 3. HALAMAN LOGIN ADMIN -->
        <div id="adminLogin" class="page-content page-content-transition hidden opacity-0 max-w-md w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center">
            
            <div class="w-full bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-100">
                <h2 class="text-3xl font-bold text-red-600 mb-8 text-center">Login Admin</h2>
                
                <form onsubmit="handleAdminLogin(event)">
                    
                    <!-- Username Input -->
                    <div class="mb-5">
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input    
                            type="text"    
                            id="adminUsername"    
                            name="username"
                            placeholder="Masukkan Username Anda"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-150"
                        >
                    </div>

                    <!-- Password Input -->
                    <div class="mb-8">
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input    
                            type="password"    
                            id="adminPassword"    
                            name="password"
                            placeholder="Masukkan Password Anda"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition duration-150"
                        >
                    </div>
                    
                    <!-- Pesan Error/Feedback -->
                    <div id="loginMessage" class="text-center text-sm text-red-500 mb-4 hidden"></div>

                    <!-- Tombol Login -->
                    <button    
                        type="submit"    
                        class="w-full bg-red-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-red-700 transition duration-200 focus:outline-none focus:ring-4 focus:ring-red-300"
                    >
                        Login
                    </button>
                </form>
            </div>
            
            <!-- Tombol Kembali -->
            <button onclick="showPage('mainHero')" class="mt-6 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Beranda
            </button>
        </div>
        
        <!-- 4. HALAMAN DASHBOARD ADMIN -->
        <div id="adminDashboard" class="page-content page-content-transition hidden opacity-0 max-w-5xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <!-- MENGHILANGKAN TOMBOL KEMBALI DARI DASHBOARD ADMIN -->
            
            <h2 class="text-4xl font-extrabold text-blue-900 mb-6 text-center">Selamat Datang, Admin!</h2>
            <p class="text-lg text-gray-600 mb-10 text-center">Anda telah berhasil login ke Dashboard Administrasi PT. Sahabat Intim Plasindo.</p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                <!-- Update Karyawan -->
                <a href="#" onclick="showPage('employeeInputPage')" class="block p-5 bg-green-50 rounded-xl shadow-lg border border-green-200 text-center hover:bg-green-100 transition duration-150">
                    <h3 class="text-xl font-bold text-green-800">Update<br>Karyawan</h3>
                    <p class="text-gray-600 mt-2 px-1">Update karyawan baru seperti Nama Karyawan, No. Absen, Bagian, Dll.</p>
                </a>
                <!-- Update Permasalahan Karyawan -->
                <a href="#" onclick="showPage('employeeListPage')" class="block p-5 bg-yellow-50 rounded-xl shadow-lg border border-yellow-200 text-center hover:bg-yellow-100 transition duration-150">
                    <h3 class="text-xl font-bold text-yellow-800">Update<br>Permasalahan<br>Karyawan</h3>
                    <p class="text-gray-600 mt-2 px-1">Update permasalahan, berikan SP atau Potong Gaji.</p>
                </a>
                <!-- Update Permasalahan Produksi -->
                <a href="#" onclick="showPage('productionReportPage')" class="block p-5 bg-blue-50 rounded-xl shadow-lg border border-blue-200 text-center hover:bg-blue-100 transition duration-150">
                    <h3 class="text-xl font-bold text-blue-800">Update<br>Permasalahan<br>Produksi</h3>
                    <p class="text-gray-600 mt-2 px-1">Laporan permasalahan produksi seperti adanya barang yang BS atau rusak.</p>
                </a>
            </div>
        </div>

        <!-- 5. HALAMAN UPDATE KARYAWAN (DIRUBAH TOTAL) -->
        <div id="employeeInputPage" class="page-content page-content-transition hidden opacity-0 max-w-6xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex-col items-center justify-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6">
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <!-- Bagian Daftar Karyawan (Tampil Secara Default) -->
            <div id="employeeListSection" class="w-full">
                <h2 class="text-3xl font-extrabold text-green-700 mb-6 text-center">Data Karyawan Tersimpan</h2>
                
                <!-- NEW: Status untuk Delete/Load List -->
                <div id="adminListStatus" class="text-center p-3 rounded-lg mb-4 hidden"></div>

                <!-- Kontainer Aksi Delete dan Tabel -->
                <div class="w-full">
                    <!-- Tombol Aksi Massal (Delete) -->
                    <button 
                        id="deleteSelectedButton" 
                        onclick="showDeleteConfirmation()" 
                        class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-700 transition duration-200 mb-4 hidden"
                    >
                        Hapus Data Terpilih
                    </button>

                    <!-- Kontainer Tabel Admin -->
                    <div id="adminEmployeeListContainer" class="w-full bg-white rounded-xl shadow-lg border border-gray-100 p-2 mb-6 table-container-responsive">
                        <!-- Tabel akan dimuat di sini oleh JavaScript -->
                        <p class="text-center text-gray-500 py-4">Memuat data...</p>    
                    </div>
                </div>

                <!-- Tombol Tambah Data Karyawan Baru (DIUBAH DARI w-full MENJADI w-auto mx-auto DAN DIBUNGKUS DIV UNTUK RATA TENGAH) -->
                <div class="w-full flex justify-center">
                    <button id="showAddFormButton" class="w-auto mx-auto bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-green-700 transition duration-200">
                        + Tambah Data Karyawan Baru
                    </button>
                </div>
            </div>
        
            <!-- Bagian Form Input (Tersembunyi Secara Default) -->
            <div id="addEmployeeFormSection" class="hidden w-full">
                <h2 class="text-3xl font-extrabold text-green-700 mb-6 text-center">Input Data Karyawan Baru</h2>
                
                <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) - DIHAPUS DARI SINI -->
                <!-- Menghilangkan tombol kembali di sub-halaman Input Data Karyawan Baru -->
                
                <div class="w-full bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-100">
                    <form id="employeeForm" onsubmit="saveEmployeeData(event)">
                        
                        <!-- Status dan Feedback -->
                        <div id="employeeStatus" class="text-center p-3 rounded-lg mb-4 hidden"></div>
    
                        <!-- BARIS 1: Nama Karyawan & No. Absen -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mb-4">
                                <label for="nama" class="block text-sm font-medium text-gray-700 mb-1">Nama Karyawan</label>
                                <input type="text" id="nama" name="nama" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition" oninput="this.value = this.value.toUpperCase()">
                            </div>
                            <div class="mb-4">
                                <label for="noAbsen" class="block text-sm font-medium text-gray-700 mb-1">No. Absen</label>
                                <input type="text" id="noAbsen" name="noAbsen" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition" oninput="this.value = this.value.toUpperCase()">
                            </div>
                        </div>
    
                        <!-- BARIS 2: Tanggal Masuk & Status Pekerjaan -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mb-4">
                                <label for="tglMasuk" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Masuk</label>
                                <!-- IMPROVEMENT: Menggunakan input type="date" untuk date picker bawaan browser -->
                                <input type="date" id="tglMasuk" name="tglMasuk" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition">
                            </div>
                            <div class="mb-4">
                                <label for="statusPekerjaan" class="block text-sm font-medium text-gray-700 mb-1">Status Pekerjaan</label>
                                <select id="statusPekerjaan" name="statusPekerjaan" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition">
                                    <option value="" disabled selected>Pilih Status</option>
                                    <option value="TRAINEE">TRAINEE</option>
                                    <option value="PHL">PHL</option>
                                    <option value="KONTRAK">KONTRAK</option>
                                    <option value="STAFF">STAFF</option>
                                    <option value="KARYAWAN TETAP">KARYAWAN TETAP</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- BARIS 3: Bagian & Pendidikan -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mb-4">
                                <label for="bagian" class="block text-sm font-medium text-gray-700 mb-1">Bagian</label>
                                <input type="text" id="bagian" name="bagian" placeholder="Masukkan Bagian" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition" oninput="this.value = this.value.toUpperCase()">
                            </div>
                            <div class="mb-4">
                                <label for="pendidikan" class="block text-sm font-medium text-gray-700 mb-1">Pendidikan</label>
                                <select id="pendidikan" name="pendidikan" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition">
                                    <option value="" disabled selected>Pilih Pendidikan</option>
                                    <option value="SD">SD</option>
                                    <option value="SMP">SMP</option>
                                    <option value="SMA/SMK">SMA/SMK</option>
                                    <option value="D3">D3</option>
                                    <option value="S1">S1</option>
                                </select>
                            </div>
                        </div>

                        <!-- BARIS 4: Agama & Jenis Kelamin -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mb-4">
                                <label for="agama" class="block text-sm font-medium text-gray-700 mb-1">Agama</label>
                                <select id="agama" name="agama" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition">
                                    <option value="" disabled selected>Pilih Agama</option>
                                    <option value="ISLAM">ISLAM</option>
                                    <option value="KRISTEN">KRISTEN</option>
                                    <option value="KATOLIK">KATOLIK</option>
                                    <option value="HINDU">HINDU</option>
                                    <option value="BUDDHA">BUDDHA</option>
                                    <option value="KONGHUCU">KONGHUCU</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label for="jenisKelamin" class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin</label>
                                <select id="jenisKelamin" name="jenisKelamin" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition">
                                    <option value="" disabled selected>Pilih Jenis Kelamin</option>
                                    <option value="LAKI - LAKI">LAKI - LAKI</option>
                                    <option value="PEREMPUAN">PEREMPUAN</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- BARIS 5: Tempat Tanggal Lahir & Status Perkawinan -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mb-4">
                                <label for="tptTglLahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat, Tanggal Lahir</label>
                                <input type="text" id="tptTglLahir" name="tptTglLahir" placeholder="Contoh: JAKARTA, 01/01/1990" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition" oninput="this.value = this.value.toUpperCase()">
                            </div>
                            <div class="mb-4">
                                <label for="statusKawin" class="block text-sm font-medium text-gray-700 mb-1">Status Perkawinan</label>
                                <select id="statusKawin" name="statusKawin" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition">
                                    <option value="" disabled selected>Pilih Status</option>
                                    <option value="BELUM MENIKAH">BELUM MENIKAH</option>
                                    <option value="MENIKAH">MENIKAH</option>
                                    <option value="CERAI HIDUP">CERAI HIDUP</option>
                                    <option value="CERAI MATI">CERAI MATI</option>
                                </select>
                            </div>
                        </div>

                        <!-- BARIS 6: No. WhatsApp & Alamat -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="mb-4">
                                <label for="noWa" class="block text-sm font-medium text-gray-700 mb-1">No. WhatsApp</label>
                                <input type="text" id="noWa" name="noWa" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition" onkeypress="return (event.charCode >= 48 && event.charCode <= 57)">
                            </div>
                            <div class="mb-4">
                                <label for="alamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat Lengkap</label>
                                <textarea id="alamat" name="alamat" rows="2" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition" oninput="this.value = this.value.toUpperCase()"></textarea>
                            </div>
                        </div>
                        
                        <!-- BARIS 7: Foto Karyawan -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="mb-4">
                                <label for="fotoKaryawan" class="block text-sm font-medium text-gray-700 mb-1">Foto Karyawan (Max 500KB)</label>
                                <input type="file" id="fotoKaryawan" name="fotoKaryawan" accept="image/jpeg, image/png" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition" onchange="previewImage(event)">
                            </div>
                            <div class="mb-4 flex items-center justify-center border border-gray-300 rounded-lg p-2">
                                <img id="imagePreview" src="https://placehold.co/100x100/eeeeee/333333?text=Pratinjau+Foto" alt="Pratinjau Foto" class="w-24 h-24 object-cover rounded-md">
                            </div>
                        </div>
                        
                        <!-- Tombol Aksi Form -->
                         <div class="flex flex-col sm:flex-row gap-4 mt-4">
                            <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-green-700 transition">
                                Simpan Data
                            </button>
                            <button type="button" id="cancelAddFormButton" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-gray-600 transition">
                                Batal
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Tombol Kembali ke Dashboard (DIHAPUS) -->
            <!-- <button onclick="showPage('adminDashboard')" class="mt-6 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Dashboard Admin
            </button> -->
        </div>
        
        <!-- 6. HALAMAN DAFTAR KARYAWAN (PERMASALAHAN KARYAWAN) -->
        <div id="employeeListPage" class="page-content page-content-transition hidden opacity-0 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-10 flex flex-col items-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6">
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <h2 class="text-3xl font-extrabold text-yellow-800 mb-6 text-center">Update Permasalahan Karyawan</h2>
            <p class="text-lg text-gray-600 mb-6 text-center">Pilih karyawan untuk mengupdate data permasalahan seperti SP atau potong gaji.</p>
            
            <!-- Tabel Kontainer (Responsif) -->
            <div id="employeeTableContainer" class="w-full bg-white rounded-xl shadow-2xl border border-gray-100 p-2 mt-4 table-container-responsive">
                 <!-- Konten tabel akan dimuat oleh JavaScript -->
                 <p class="text-center text-gray-500 py-4">Memuat data...</p>
            </div>
            
            <!-- Tombol Kembali -->
            <!-- MENGHAPUS TOMBOL 'Kembali ke Dashboard Admin' dari bagian bawah -->
            
        </div>
        
        <!-- 7. HALAMAN ABOUT -->
        <div id="aboutPage" class="page-content page-content-transition hidden opacity-0 max-w-3xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center text-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <!-- TELAH DIHAPUS: <div class="w-full text-left mb-6"><button onclick="goBack()" class="back-button-flow">&larr; Kembali</button></div> -->
            
            <h2 class="text-4xl font-extrabold text-blue-900 mb-6">Tentang Kami</h2>
            <p class="text-lg text-gray-600 mb-8">Didirikan pada tahun 1982, PT. Sahabat Intim Plasindo adalah salah satu produsen peralatan rumah tangga dan furniture plastik terkemuka di Indonesia. Kami berkomitmen untuk terus memperluas pasar, menciptakan produk yang handal dan inovatif, serta meningkatkan praktik bisnis kami untuk menjaga kepuasan pelanggan.</p>
            <p class="text-lg text-gray-600 mb-10">Pertumbuhan kami didorong oleh meningkatnya permintaan pasar, dan desain produk kami berfokus pada fungsi. Selama lebih dari 30 tahun, kami telah menciptakan produk berdasarkan kebutuhan pelanggan dan berfokus pada optimalisasi pengalaman pengguna. Kami berupaya untuk membuat kehidupan sehari-hari lebih nyaman dan teratur, sehingga lebih sederhana dan bebas dari kekacauan.</p>
            <button onclick="showPage('mainHero')" class="mt-8 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Beranda
            </button>
        </div>

        <!-- 8. HALAMAN CONTACT -->
        <div id="contactPage" class="page-content page-content-transition hidden opacity-0 max-w-md w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <!-- TELAH DIHAPUS: <div class="w-full text-left mb-6"><button onclick="goBack()" class="back-button-flow">&larr; Kembali</button></div> -->
            
            <h2 class="text-4xl font-extrabold text-blue-900 mb-8 text-center">Hubungi Kami</h2>
            <div class="w-full bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-100 text-left">
                <p class="mb-4"><span class="font-semibold">Alamat:</span> Jalan Peternakan III No. 38, Kota Administrasi Jakarta Barat, Daerah Khusus Ibukota Jakarta 11720, Indonesia</p>
                <p class="mb-4"><span class="font-semibold">Telepon:</span> +62 851-7506-5351</p>
                <p class="mb-4"><span class="font-semibold">Email:</span> admprod21@gmail.com</p>
                
                <h3 class="text-xl font-bold text-gray-700 mt-6 mb-4">Kirim Pesan</h3>
                <form onsubmit="handleContactSubmit(event)">
                    <input type="text" placeholder="Nama Anda" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3" required>
                    <input type="email" placeholder="Email Anda" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3" required>
                    <textarea placeholder="Pesan Anda" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4" required></textarea>
                    <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition">Kirim</button>
                </form>
            </div>
            <button onclick="showPage('mainHero')" class="mt-6 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Beranda
            </button>
        </div>

        <!-- 9. HALAMAN LAPORAN PRODUKSI (ADMIN) -->
        <div id="productionReportPage" class="page-content page-content-transition hidden opacity-0 max-w-3xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center text-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6">
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <h2 class="text-4xl font-extrabold text-blue-900 mb-6">Update Permasalahan Produksi</h2>
            <p class="text-lg text-gray-600 mb-10">Halaman ini akan berisi laporan barang BS/rusak. (Fitur dalam pengembangan)</p>
            <button onclick="showPage('adminDashboard')" class="mt-8 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Dashboard Admin
            </button>
        </div>
        
        <!-- 10. HALAMAN BIODATA PENGGUNA (CARI KARYAWAN) -->
        <div id="biodataPage" class="page-content page-content-transition hidden opacity-0 max-w-2xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6">
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <h2 class="text-3xl font-extrabold text-green-700 mb-6 text-center">Cari Biodata Karyawan</h2>
            <div class="w-full bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-gray-100">
                <!-- Form Pencarian -->
                <form id="searchForm" onsubmit="searchEmployee(event)" class="flex flex-col sm:flex-row items-center gap-3 mb-6">
                    <input    
                        type="text"    
                        id="searchName"    
                        name="searchName"    
                        placeholder="Ketik nama lengkap Anda di sini..."
                        required    
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 transition duration-150"
                    >
                    <button    
                        type="submit"    
                        class="w-full sm:w-auto bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-green-700 transition duration-200"
                    >
                        Cari
                    </button>
                </form>

                <!-- Kontainer Hasil Pencarian -->
                <div id="searchResultContainer" class="mt-4 space-y-4">
                    <!-- Hasil akan ditampilkan di sini -->
                     <p class="text-center text-gray-500">Silakan masukkan nama Anda untuk memulai pencarian.</p>
                </div>
            </div>
            
            <!-- Tombol Kembali -->
            <!-- MENGHAPUS TOMBOL 'Kembali ke Menu Pengguna' dari bagian bawah -->
            
        </div>

        <!-- 11. HALAMAN PERMASALAHAN KARYAWAN (PENGGUNA) -->
        <div id="userProblemPage" class="page-content page-content-transition hidden opacity-0 max-w-3xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center text-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6">
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <h2 class="text-4xl font-extrabold text-yellow-800 mb-6">Informasi Permasalahan Karyawan</h2>
            <p class="text-lg text-gray-600 mb-10">Untuk pertanyaan atau laporan terkait permasalahan personalia, silakan hubungi departemen HRD secara langsung.</p>
            <button onclick="showPage('userMenu')" class="mt-8 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Menu Pengguna
            </button>
        </div>

        <!-- 12. HALAMAN PERMASALAHAN PRODUKSI (PENGGUNA) -->
        <div id="userProductionPage" class="page-content page-content-transition hidden opacity-0 max-w-3xl w-full mx-auto px-4 sm:px-6 lg:px-8 pt-20 flex flex-col items-center justify-center text-center">
            <!-- WRAPPER UNTUK TOMBOL KEMBALI (RATA KIRI) -->
            <div class="w-full text-left mb-6">
                <button onclick="goBack()" class="back-button-flow">&larr; Kembali</button>
            </div>
            
            <h2 class="text-4xl font-extrabold text-blue-800 mb-6">Informasi Permasalahan Produksi</h2>
            <p class="text-lg text-gray-600 mb-10">Untuk melaporkan masalah produksi seperti barang rusak (BS), silakan hubungi kepala regu atau supervisor di bagian Anda.</p>
            <button onclick="showPage('userMenu')" class="mt-8 text-blue-500 hover:text-blue-700 transition duration-150">
                &larr; Kembali ke Menu Pengguna
            </button>
        </div>

        <!-- MODAL BARU UNTUK DETAIL KARYAWAN -->
        <div id="employeeDetailModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-[60]">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 sm:p-8 relative" id="modalDialog">
                <button id="closeModalButton" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
                <div id="modalContent">
                    <!-- Konten detail akan dimuat di sini oleh JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- MODAL KONFIRMASI DELETE -->
        <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 relative">
                <h3 class="text-xl font-bold text-red-600 mb-4">Konfirmasi Penghapusan</h3>
                <p id="deleteConfirmMessage" class="text-gray-700 mb-6">Apakah Anda yakin ingin menghapus data karyawan yang terpilih?</p>
                <div class="flex justify-end gap-3">
                    <button onclick="hideDeleteConfirmation()" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition">
                        Batal
                    </button>
                    <button onclick="deleteSelectedEmployees()" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition">
                        Ya, Hapus
                    </button>
                </div>
            </div>
        </div>
        
        <!-- MODAL BARU: KONFIRMASI LOGOUT -->
        <div id="logoutConfirmModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 relative">
                <h3 class="text-xl font-bold text-blue-600 mb-4">Konfirmasi Logout</h3>
                <p class="text-gray-700 mb-6">Apakah Anda yakin ingin keluar dari sesi Admin?</p>
                <div class="flex justify-end gap-3">
                    <button onclick="hideLogoutConfirmation()" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition">
                        Batal
                    </button>
                    <button onclick="handleLogout()" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition">
                        Ya, Logout
                    </button>
                </div>
            </div>
        </div>
        
        <!-- MODAL BARU: INPUT PERMASALAHAN KARYAWAN -->
        <div id="problemInputModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-[70]">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 relative">
                <button onclick="hideProblemInputModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
                <h3 id="problemModalTitle" class="text-xl font-bold text-yellow-800 mb-2">Input Masalah Karyawan</h3>
                <div id="problemModalEmployeeInfo" class="text-sm text-gray-600 mb-4 border-b pb-2"></div>

                <form id="problemForm" onsubmit="saveEmployeeProblem(event)">
                    <input type="hidden" id="problemEmployeeId">
                    <div id="problemStatus" class="text-center p-3 rounded-lg mb-4 hidden"></div>

                    <!-- Pilihan Jenis Masalah -->
                    <div class="mb-4">
                        <label for="problemType" class="block text-sm font-medium text-gray-700 mb-1">Jenis Permasalahan</label>
                        <select id="problemType" onchange="toggleProblemForm(this.value)" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 transition">
                            <option value="" disabled selected>Pilih Jenis</option>
                            <option value="SP">SP (Surat Peringatan)</option>
                            <option value="Potong Gaji">Potong Gaji</option>
                        </select>
                    </div>

                    <!-- Input SP (Tersembunyi Awal) -->
                    <div id="spInputs" class="hidden space-y-4 border p-4 rounded-lg bg-red-50 border-red-200">
                        <h4 class="font-bold text-red-700">Detail SP</h4>
                        <div>
                            <label for="spDate" class="block text-sm font-medium text-gray-700 mb-1">Tanggal SP</label>
                            <input type="date" id="spDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition">
                        </div>
                        <div>
                            <label for="spLevel" class="block text-sm font-medium text-gray-700 mb-1">Jumlah SP</label>
                            <select id="spLevel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition">
                                <option value="" disabled selected>Pilih Level SP</option>
                                <option value="SP I">SP I</option>
                                <option value="SP II">SP II</option>
                            </select>
                        </div>
                        <div>
                            <label for="spDetail" class="block text-sm font-medium text-gray-700 mb-1">Detail Masalah</label>
                            <textarea id="spDetail" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 transition"></textarea>
                        </div>
                    </div>

                    <!-- Input Potong Gaji (Tersembunyi Awal) -->
                    <div id="potongGajiInputs" class="hidden space-y-4 border p-4 rounded-lg bg-yellow-50 border-yellow-200">
                        <h4 class="font-bold text-yellow-700">Detail Potong Gaji</h4>
                        <div>
                            <label for="potongDate" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Potong Gaji</label>
                            <input type="date" id="potongDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 transition">
                        </div>
                        <div>
                            <label for="potongNominal" class="block text-sm font-medium text-gray-700 mb-1">Nominal Potong Gaji (Rupiah)</label>
                            <!-- NOTE: Menggunakan type="text" dengan oninput untuk format Rupiah -->
                            <input type="text" id="potongNominal" oninput="formatRupiah(this)" placeholder="Contoh: 100.000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 transition">
                        </div>
                        <div>
                            <label for="potongDetail" class="block text-sm font-medium text-gray-700 mb-1">Detail Masalah</label>
                            <textarea id="potongDetail" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 transition"></textarea>
                        </div>
                    </div>

                    <!-- Tombol Simpan -->
                    <button    
                        type="submit"    
                        id="saveProblemButton"
                        class="w-full bg-yellow-600 text-white font-bold py-3 rounded-lg shadow-md hover:bg-yellow-700 transition duration-200 mt-6"
                    >
                        Simpan Permasalahan
                    </button>
                </form>
            </div>
        </div>

        <!-- JavaScript untuk mengontrol menu burger, navigasi, dan SUPABASE -->
        <script>
            // Global variable for Supabase
            let supabase;
            let isAdminLoggedIn = false; // State untuk tracking login admin
            let navHistory = ['mainHero']; // Untuk melacak halaman sebelumnya
            
            // Variabel Carousel
            let slideIndex = 0;
            let carouselInterval;


            // FUNGSI INTI SUPABASE
            function initSupabase() {
                // DANGER: Kunci API (anon key) Anda terekspos di sisi klien.
                // Ini aman untuk RLS (Row Level Security) tetapi merupakan praktik yang buruk untuk
                // membiarkannya langsung di dalam kode. Sebaiknya gunakan sistem otentikasi yang sebenarnya.
                const supabaseUrl = 'https://xzchpfbcmusknizzmgke.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6Y2hwZmJjbXVza25penptZ2tlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMTU3MjQsImV4cCI6MjA3NTc5MTcyNH0.g38f6c7R6YOMA2BNy4l9f2oWzB6JzIPAJ6uLF9Lh6a0';
                
                // Cek jika Supabase Client sudah tersedia dari CDN
                if (window.supabase) {
                    supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                    console.log("Supabase client initialized.");
                } else {
                    console.error("Supabase client not found. Make sure the script is loaded in the <head>.");
                }
            }
            
            // FUNGSI CAROUSEL
            function showSlides() {
                const slides = document.querySelectorAll('#mainCarousel .carousel-item');
                if (slides.length === 0) return;

                // Reset semua slide
                slides.forEach(slide => slide.classList.remove('active'));

                // Atur index
                if (slideIndex >= slides.length) { slideIndex = 0 }
                if (slideIndex < 0) { slideIndex = slides.length - 1 }
                
                // Aktifkan slide yang sekarang
                slides[slideIndex].classList.add('active');
            }

            function changeSlide(n) {
                // Tombol manual sudah dihapus, fungsi ini hanya dipanggil oleh interval
                clearInterval(carouselInterval);
                
                slideIndex += n;
                showSlides();
                
                // Restart interval
                startCarousel();
            }

            function startCarousel() {
                 const slides = document.querySelectorAll('#mainCarousel .carousel-item');
                 if (slides.length > 1) {
                    // Set interval baru (ganti slide setiap 5 detik)
                    carouselInterval = setInterval(() => {
                        slideIndex++;
                        showSlides();
                    }, 5000);
                 }
            }

            function stopCarousel() {
                clearInterval(carouselInterval);
            }

            // FUNGSI UNTUK MENGUBAH FILE MENJADI BASE64
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                    reader.readAsDataURL(file);
                });
            }
            
            // FUNGSI UNTUK PRATINJAU GAMBAR
            function previewImage(event) {
                const file = event.target.files[0];
                const preview = document.getElementById('imagePreview');
                const statusDiv = document.getElementById('employeeStatus');

                if (file) {
                    if (file.size > 500 * 1024) { // Batas 500KB
                        statusDiv.textContent = "Error: Ukuran file melebihi batas 500KB!";
                        statusDiv.className = 'text-center p-3 rounded-lg mb-4 bg-red-100 text-red-700';
                        event.target.value = "";    
                        preview.src = "https://placehold.co/100x100/eeeeee/333333?text=Max+500KB";
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.src = "https://placehold.co/100x100/eeeeee/333333?text=Pratinjau+Foto";
                }
                statusDiv.classList.add('hidden');
            }

            // FUNGSI UNTUK MENAMPILKAN/MENYEMBUNYIKAN TOMBOL KEMBALI
            function toggleBackButton(pageId) {
                // Halaman yang TIDAK memiliki tombol kembali (halaman utama/login/ABOUT/CONTACT)
                const noFlowBackButtonPages = ['mainHero', 'adminLogin', 'aboutPage', 'contactPage']; 
                
                // Cek semua tombol kembali di halaman tujuan
                const backButtons = document.querySelectorAll(`#${pageId} .back-button-flow`);
                
                backButtons.forEach(button => {
                    if (noFlowBackButtonPages.includes(pageId)) {
                        button.style.display = 'none';
                    } else {
                        // Tombol kembali di dalam wrapper rata kiri, yang kita inginkan
                        // Periksa apakah halaman yang ditampilkan adalah halaman Form Input Karyawan
                        const isEmployeeInputFormVisible = (pageId === 'employeeInputPage' && document.getElementById('addEmployeeFormSection') && !document.getElementById('addEmployeeFormSection').classList.contains('hidden'));
                        
                        if (pageId === 'employeeInputPage') {
                            // Di halaman employeeInputPage, kita cek sub-bagian mana yang terlihat.
                            if (document.getElementById('employeeListSection') && !document.getElementById('employeeListSection').classList.contains('hidden')) {
                                // Jika Daftar Karyawan (List) yang terlihat: Tampilkan tombol Kembali
                                button.style.display = 'inline-block';
                            } else {
                                // Jika Form Input Karyawan yang terlihat: Sembunyikan tombol Kembali (karena ada tombol Batal)
                                button.style.display = 'none';
                            }
                        } else if (pageId === 'employeeListPage') {
                            // Di halaman employeeListPage (Update Permasalahan Karyawan), tombol kembali akan muncul.
                            button.style.display = 'inline-block'; 
                        } else if (pageId === 'userMenu') { // Halaman Menu Pengguna
                             button.style.display = 'inline-block';
                        } else if (button.parentElement.classList.contains('text-left')) {
                            // Untuk halaman lain, tampilkan jika ada wrapper rata kiri
                            button.style.display = 'inline-block';
                        } else {
                            // Tombol kembali di bagian bawah halaman
                            button.style.display = 'none';
                        }
                    }
                });
            }


            // FUNGSI UNTUK KEMBALI KE HALAMAN SEBELUMNYA
            function goBack() {
                if (navHistory.length > 1) {
                    // Hapus halaman saat ini dari riwayat
                    navHistory.pop(); 
                    // Ambil halaman sebelumnya
                    const previousPageId = navHistory[navHistory.length - 1]; 
                    // Navigasi tanpa menambahkan ke riwayat (menggunakan flag 'back')
                    showPage(previousPageId, true);
                } else {
                    // Jika tidak ada riwayat, kembali ke halaman utama (Hero)
                    showPage('mainHero');
                }
            }


            // FUNGSI NAVIGASI HALAMAN (diperbarui untuk menangani riwayat)
            function showPage(pageId, isBack = false) {
                const currentPage = document.querySelector('.page-content:not(.hidden)');
                const targetPage = document.getElementById(pageId);
                
                if (!targetPage || targetPage === currentPage) return;    

                // 1. Kontrol Carousel (Stop saat meninggalkan Home, Start saat masuk Home)
                if (currentPage && currentPage.id === 'mainHero') {
                    stopCarousel();
                }
                if (pageId === 'mainHero') {
                    // Pastikan carousel terlihat
                    document.getElementById('mainCarouselContainer').classList.remove('hidden');
                    // Tunggu sedikit setelah transisi untuk memastikan elemen dimuat
                    setTimeout(() => {
                        showSlides();
                        startCarousel(); 
                    }, 50); 
                } else {
                    // Sembunyikan carousel jika tidak di mainHero
                    document.getElementById('mainCarouselContainer').classList.add('hidden');
                }


                // 2. Perbarui Riwayat Navigasi
                if (!isBack) {
                    // Cegah duplikasi saat berpindah ke halaman yang sama (walaupun logika di atas sudah mencegahnya)
                    if (navHistory[navHistory.length - 1] !== pageId) {
                        navHistory.push(pageId);
                    }
                } else {
                    // Jika ini adalah aksi kembali, riwayat sudah disesuaikan di goBack()
                }
                
                // 3. Kontrol Tombol Kembali (logika toggleBackButton akan dipanggil setelah transisi)
                
                // 4. Kontrol State Aplikasi untuk Header
                const body = document.body;
                const adminPages = ['adminDashboard', 'employeeInputPage', 'employeeListPage', 'productionReportPage'];
                const userPages = ['userMenu', 'biodataPage', 'userProblemPage', 'userProductionPage'];

                if (adminPages.includes(pageId)) {
                    body.setAttribute('data-app-state', 'admin-view');
                } else if (userPages.includes(pageId)) {
                    body.setAttribute('data-app-state', 'user-view');
                } else {
                    body.setAttribute('data-app-state', 'public-view');
                }

                // 5. Jika pindah MASUK ke halaman yang perlu data, panggil fungsi load
                if (pageId === 'employeeListPage') {
                    loadEmployeeData();
                } else if (pageId === 'employeeInputPage') {
                    loadAdminEmployeeList(); // Muat daftar saat halaman update dibuka
                    document.getElementById('addEmployeeFormSection').classList.add('hidden');
                    document.getElementById('employeeListSection').classList.remove('hidden');
                }

                // Tutup menu burger jika terbuka
                const navMenu = document.getElementById('navMenu');
                if (navMenu && !navMenu.classList.contains('hidden')) {
                    document.getElementById('menuButton').click();
                }

                // 6. LOGIKA TRANSISI (PENTING)
                if (currentPage) {
                    // Fade out current page
                    currentPage.classList.remove('opacity-100');
                    currentPage.classList.add('opacity-0');

                    setTimeout(() => {
                        // Hide current page and show target page after fade out
                        currentPage.classList.add('hidden');
                        targetPage.classList.remove('hidden');
                        targetPage.classList.toggle('flex', targetPage.id !== 'mainHero');
                        
                        // Set visibility for back button before fade in
                        toggleBackButton(pageId);

                        // Fade in target page
                        setTimeout(() => {
                            targetPage.classList.remove('opacity-0');
                            targetPage.classList.add('opacity-100');
                        }, 50); // Delay kecil sebelum fade-in
                    }, 300); // Durasi fade-out (0.3s sesuai CSS transition)
                } else {
                    // Initial load/no current page
                    targetPage.classList.remove('hidden');
                    targetPage.classList.toggle('flex', targetPage.id !== 'mainHero');
                    toggleBackButton(pageId); // Set visibility immediately
                    setTimeout(() => {
                        targetPage.classList.remove('opacity-0');
                        targetPage.classList.add('opacity-100');
                    }, 50);
                }
            }
            
            // FUNGSI LOGIC LOGIN ADMIN
            function handleAdminLogin(event) {
                event.preventDefault();    
                const usernameInput = document.getElementById('adminUsername');
                const passwordInput = document.getElementById('adminPassword');
                const messageDiv = document.getElementById('loginMessage');
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();

                const VALID_USERNAME = 'entrydata';
                const VALID_PASSWORD = 'admshinpo';

                messageDiv.classList.add('hidden');
                
                if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                    isAdminLoggedIn = true;
                    usernameInput.value = '';    
                    passwordInput.value = '';
                    showPage('adminDashboard');    
                } else {
                    messageDiv.innerHTML = 'Username atau Password salah. Silakan coba lagi.';
                    messageDiv.classList.remove('hidden');
                }
            }
            
            // FUNGSI UNTUK MENAMPILKAN MODAL LOGOUT
            function showLogoutConfirmation() {
                document.getElementById('logoutConfirmModal').classList.remove('hidden');
                document.getElementById('logoutConfirmModal').classList.add('flex');
            }

            // FUNGSI UNTUK MENYEMBUNYIKAN MODAL LOGOUT
            function hideLogoutConfirmation() {
                document.getElementById('logoutConfirmModal').classList.add('hidden');
                document.getElementById('logoutConfirmModal').classList.remove('flex');
            }

            // FUNGSI LOGOUT ADMIN (Dipanggil dari tombol "Ya, Logout" di modal)
            function handleLogout() {
                hideLogoutConfirmation(); // Sembunyikan modal
                isAdminLoggedIn = false;
                navHistory = ['mainHero']; // Reset history on logout
                showPage('mainHero');
            }
            
            // FUNGSI SIMPAN DATA KARYAWAN KE SUPABASE
            async function saveEmployeeData(event) {
                event.preventDefault();
                const statusDiv = document.getElementById('employeeStatus');
                statusDiv.className = 'text-center p-3 rounded-lg mb-4'; // Reset class
                
                if (!supabase) {
                    statusDiv.textContent = "Error: Database belum siap.";
                    statusDiv.classList.add('bg-red-100', 'text-red-700');
                    return;
                }

                const form = document.getElementById('employeeForm');
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'Menyimpan...';

                // Ambil nilai dari form
                const formData = new FormData(form);
                
                // Handle Foto
                const fotoFile = document.getElementById('fotoKaryawan').files[0];
                let fotoBase64 = null;
                if (fotoFile) {
                    try {
                        fotoBase64 = await fileToBase64(fotoFile);
                    } catch (e) {
                        statusDiv.textContent = "Error: Gagal memproses file foto.";
                        statusDiv.classList.add('bg-red-100', 'text-red-700');
                        submitButton.disabled = false;
                        submitButton.textContent = 'Simpan Data';
                        return;
                    }
                }

                // Handle Tanggal (dari YYYY-MM-DD ke DD/MM/YYYY)
                const dateValue = formData.get('tglMasuk');
                let formattedDate = '';
                if (dateValue) {
                    const [year, month, day] = dateValue.split('-');
                    formattedDate = `${day}/${month}/${year}`;
                }

                const employeeData = {
                    nama: formData.get('nama'),
                    noAbsen: formData.get('noAbsen'),
                    tglMasuk: formattedDate,
                    statusPekerjaan: formData.get('statusPekerjaan'),
                    bagian: formData.get('bagian'),
                    pendidikan: formData.get('pendidikan'),
                    agama: formData.get('agama'),
                    jenisKelamin: formData.get('jenisKelamin'),
                    tptTglLahir: formData.get('tptTglLahir'),
                    statusKawin: formData.get('statusKawin'),
                    noWa: formData.get('noWa'),
                    alamat: formData.get('alamat'),
                    fotoBase64: fotoBase64,
                };
                
                try {
                    const { error } = await supabase.from('karyawan').insert([employeeData]);
                    if (error) throw error;
                    
                    form.reset();
                    document.getElementById('imagePreview').src = "https://placehold.co/100x100/eeeeee/333333?text=Pratinjau+Foto";

                    statusDiv.textContent = 'Data karyawan berhasil disimpan!';
                    statusDiv.classList.add('bg-green-100', 'text-green-700');

                    // Kembali ke daftar setelah 2 detik
                    setTimeout(() => {
                        document.getElementById('addEmployeeFormSection').classList.add('hidden');
                        document.getElementById('employeeListSection').classList.remove('hidden');
                        loadAdminEmployeeList(); // Muat ulang daftar
                    }, 2000);

                } catch (error) {
                    statusDiv.textContent = `Error saat menyimpan data: ${error.message}`;
                    statusDiv.classList.add('bg-red-100', 'text-red-700');
                    console.error("Error saving document: ", error);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Simpan Data';
                    statusDiv.classList.remove('hidden');
                }
            }
            
            // FUNGSI LOGIC CHECKBOX DAN DELETE

            // Toggle button delete visibility
            function toggleDeleteButton() {
                const checkboxes = document.querySelectorAll('.employee-checkbox:checked');
                const deleteButton = document.getElementById('deleteSelectedButton');
                if (deleteButton) {
                    if (checkboxes.length > 0) {
                        deleteButton.classList.remove('hidden');
                    } else {
                        deleteButton.classList.add('hidden');
                    }
                }
            }

            // Select All / Deselect All
            function toggleSelectAll(checked) {
                const checkboxes = document.querySelectorAll('.employee-checkbox');
                checkboxes.forEach(cb => cb.checked = checked);
                toggleDeleteButton();
            }

            // Show Custom Delete Confirmation Modal
            function showDeleteConfirmation() {
                const checkboxes = document.querySelectorAll('.employee-checkbox:checked');
                if (checkboxes.length > 0) {
                    const message = document.getElementById('deleteConfirmMessage');
                    message.innerHTML = `Apakah Anda yakin ingin menghapus **${checkboxes.length}** data karyawan yang terpilih?`;
                    document.getElementById('deleteConfirmModal').classList.remove('hidden');
                    document.getElementById('deleteConfirmModal').classList.add('flex');
                }
            }

            // Hide Custom Delete Confirmation Modal
            function hideDeleteConfirmation() {
                document.getElementById('deleteConfirmModal').classList.add('hidden');
                document.getElementById('deleteConfirmModal').classList.remove('flex');
            }

            // Delete Selected Employees Logic (FIXED: Improved status feedback)
            async function deleteSelectedEmployees() {
                hideDeleteConfirmation();
                const checkboxes = document.querySelectorAll('.employee-checkbox:checked');
                const idsToDelete = Array.from(checkboxes).map(cb => parseInt(cb.value, 10));
                const statusDiv = document.getElementById('adminListStatus'); // Status element
                
                statusDiv.classList.add('hidden'); // Reset

                if (idsToDelete.length === 0 || !supabase) {
                    // Should be caught by showDeleteConfirmation, but for safety:
                    return; 
                }

                // Show loading message
                statusDiv.textContent = `Sedang menghapus ${idsToDelete.length} data...`;
                statusDiv.className = 'text-center p-3 rounded-lg mb-4 bg-yellow-100 text-yellow-800';
                statusDiv.classList.remove('hidden');

                try {
                    // Supabase DELETE operation for multiple IDs
                    const { error } = await supabase.from('karyawan').delete().in('id', idsToDelete);
                    
                    if (error) throw error;
                    
                    // 1. Muat ulang daftar karyawan untuk refresh tampilan tabel
                    await loadAdminEmployeeList(); 
                    
                    // 2. Berikan pesan sukses yang jelas
                    statusDiv.textContent = `${idsToDelete.length} data karyawan berhasil dihapus.`;
                    statusDiv.className = 'text-center p-3 rounded-lg mb-4 bg-green-100 text-green-700';
                    statusDiv.classList.remove('hidden');
                    
                    // 3. Sembunyikan pesan sukses setelah 3 detik dan tombol delete
                    setTimeout(() => { 
                        statusDiv.classList.add('hidden'); 
                        toggleDeleteButton(); // Sembunyikan tombol delete setelah sukses
                    }, 3000);
                    
                } catch (error) {
                    // Show Error Message
                    statusDiv.textContent = `Gagal menghapus data: ${error.message}`;
                    statusDiv.className = 'text-center p-3 rounded-lg mb-4 bg-red-100 text-red-700';
                    statusDiv.classList.remove('hidden');
                    
                    console.error("Error deleting documents: ", error);
                    
                    // Reload list just in case of partial or soft failure
                    await loadAdminEmployeeList();
                }
            }

            // FUNGSI BARU: Mengubah format tanggal dari YYYY-MM-DD ke DD/MM/YYYY
            function formatProblemDate(dateString) {
                if (!dateString) return '-';
                const [year, month, day] = dateString.split('-');
                return `${day}/${month}/${year}`;
            }
            
            // FUNGSI BARU: Format Nominal ke Rupiah
            function formatRupiah(input) {
                let number_string = input.value.replace(/[^,\d]/g, '').toString(),
                    split = number_string.split(','),
                    sisa = split[0].length % 3,
                    rupiah = split[0].substr(0, sisa),
                    ribuan = split[0].substr(sisa).match(/\d{3}/gi);

                if (ribuan) {
                    separator = sisa ? '.' : '';
                    rupiah += separator + ribuan.join('.');
                }

                rupiah = split[1] != undefined ? rupiah + ',' + split[1] : rupiah;
                input.value = rupiah;
            }


            // FUNGSI BARU: Render list permasalahan (Sekarang mengambil dari Supabase)
            async function renderProblemList(employeeId) {
                if (!supabase) return '<p class="text-red-500 italic text-center py-2">Koneksi database bermasalah.</p>';

                try {
                    const { data: problems, error } = await supabase
                        .from('employee_problems') // Mengambil data dari tabel baru
                        .select('*')
                        .eq('employee_id', employeeId)
                        .order('problem_date', { ascending: false });

                    if (error) throw error;
                    
                    if (problems.length === 0) {
                        return '<p class="text-gray-500 italic text-center py-2">Tidak ada riwayat permasalahan tercatat.</p>';
                    }

                    return `
                        <div class="space-y-3 mt-4 border-t pt-4 border-dashed border-gray-300">
                            <h4 class="text-lg font-bold text-red-600">Riwayat Permasalahan (${problems.length})</h4>
                            ${problems.map(p => {
                                let nominalDisplay = '';
                                // Nominal sudah berupa float dari Supabase
                                if (p.problem_type === 'Potong Gaji' && p.nominal !== undefined && p.nominal !== null) {
                                    // p.nominal.toLocaleString('id-ID') akan bekerja pada float
                                    nominalDisplay = `Rp ${p.nominal.toLocaleString('id-ID')}`;
                                }
                                
                                return `
                                    <div class="p-3 border rounded-lg ${p.problem_type === 'SP' ? 'bg-red-50 border-red-200' : 'bg-yellow-50 border-yellow-200'}">
                                        <p class="font-bold text-md mb-1 ${p.problem_type === 'SP' ? 'text-red-700' : 'text-yellow-700'}">
                                            ${p.problem_type}: 
                                            ${p.problem_type === 'SP' ? p.problem_level : nominalDisplay}
                                        </p>
                                        <p class="text-xs text-gray-700 mb-1">Tanggal: ${formatProblemDate(p.problem_date)}</p>
                                        <p class="text-sm italic">${p.detail}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } catch (e) {
                    console.error("Error fetching problem list:", e);
                    return '<p class="text-red-500 italic text-center py-2">Gagal memuat riwayat permasalahan.</p>';
                }
            }


            // FUNGSI BARU: Render tabel karyawan (bisa dipakai ulang)
            function renderEmployeeTable(container, data, options = { showActions: false, showCheckboxes: false }) {
                if (!data || data.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-4">Belum ada data karyawan.</p>';
                    return;
                }

                const showCheckboxes = options.showCheckboxes;
                const actionButtonText = options.showCheckboxes ? 'Lihat Detail' : 'Input Masalah'; // Teks tombol aksi berbeda

                const table = document.createElement('table');
                table.className = 'min-w-full divide-y divide-gray-200';
                table.innerHTML = `
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            ${showCheckboxes ? `
                                <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                                    <input type="checkbox" onchange="toggleSelectAll(this.checked)" class="w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500">
                                </th>
                            ` : ''}
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No.</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Karyawan</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. Absen</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bagian</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tgl Masuk</th>
                            <th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            ${options.showActions ? '<th class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>' : ''}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${data.map((emp, index) => `
                            <tr class="hover:bg-gray-50">
                                ${showCheckboxes ? `
                                    <td>
                                        <input type="checkbox" value="${emp.id}" class="employee-checkbox w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500" onchange="toggleDeleteButton()">
                                    </td>
                                ` : ''}
                                <td>${index + 1}</td>
                                <td>
                                    <div class="flex items-center space-x-3">
                                        <img class="w-10 h-10 rounded-full object-cover" src="${emp.fotoBase64 || 'https://placehold.co/40x40/eee/333?text=N/A'}" alt="${emp.nama}">
                                        <span class="font-medium text-gray-800">${emp.nama}</span>
                                    </div>
                                </td>
                                <td>${emp.noAbsen}</td>
                                <td>${emp.bagian}</td>
                                <td>${emp.tglMasuk}</td>
                                <td>
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        ${emp.statusPekerjaan}
                                    </span>
                                </td>
                                ${options.showActions ? `
                                    <td>
                                        <button onclick="${options.showCheckboxes ? `showEmployeeDetailModal(${emp.id})` : `showProblemInputModal(${emp.id})`}" class="text-blue-600 hover:text-blue-900 text-sm font-medium">
                                            ${actionButtonText}
                                        </button>
                                    </td>` 
                                : ''}
                            </tr>
                        `).join('')}
                    </tbody>
                `;
                container.innerHTML = '';
                container.appendChild(table);

                // Pastikan tombol delete disembunyikan saat tabel dimuat ulang
                toggleDeleteButton();
            }


            // FUNGSI Memuat daftar karyawan di halaman admin
            async function loadAdminEmployeeList() {
                const container = document.getElementById('adminEmployeeListContainer');
                container.innerHTML = '<p class="text-center text-gray-500 py-4">Memuat data...</p>';
                try {
                    // Menggunakan onSnapshot untuk real-time update
                    const { data, error } = await supabase.from('karyawan').select('*').order('nama', { ascending: true });
                    if (error) throw error;
                    // Menambahkan opsi showCheckboxes: true
                    renderEmployeeTable(container, data, { showActions: true, showCheckboxes: true }); 
                } catch (error) {
                    container.innerHTML = `<p class="text-red-500 text-center py-4">Gagal memuat data: ${error.message}</p>`;
                }
            }

            // FUNGSI UNTUK MEMUAT DATA KARYAWAN (UNTUK ADMIN DI HALAMAN PERMASALAHAN)
            async function loadEmployeeData() {
                const container = document.getElementById('employeeTableContainer');
                container.innerHTML = '<p class="text-center text-gray-500 py-4">Memuat data...</p>';
                 try {
                    const { data, error } = await supabase.from('karyawan').select('*').order('nama', { ascending: true });
                    if (error) throw error;
                    // Menghilangkan showCheckboxes untuk halaman ini
                    renderEmployeeTable(container, data, { showActions: true, showCheckboxes: false });
                } catch (error) {
                    container.innerHTML = `<p class="text-red-500 text-center py-4">Gagal memuat data: ${error.message}</p>`;
                }
            }


            // FUNGSI Menampilkan modal detail
            async function showEmployeeDetailModal(employeeId) {
                const modal = document.getElementById('employeeDetailModal');
                const content = document.getElementById('modalContent');
                content.innerHTML = '<p class="text-center py-8">Memuat detail...</p>';
                modal.classList.remove('hidden');
                modal.classList.add('flex');

                try {
                    const { data: employee, error } = await supabase.from('karyawan').select().eq('id', employeeId).single();
                    if (error) throw error;
                    
                    // --- MODIFIKASI: Ambil Riwayat Masalah ---
                    // Menggunakan Promise.all untuk memastikan renderProblemList selesai
                    const problemListHtml = await renderProblemList(employee.id); 

                    content.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            
                            <!-- KOLOM KIRI (FOTO, NAMA, BAGIAN, NO. ABSEN) -->
                            <div class="md:col-span-1 flex flex-col items-center text-center">
                                <img src="${employee.fotoBase64 || 'https://placehold.co/160x160/eee/333?text=N/A'}" class="w-40 h-40 rounded-full object-cover border-4 border-gray-200 mb-4 shadow-md">
                                
                                <!-- Nama Karyawan (1 Baris) -->
                                <h2 class="text-xl font-bold text-gray-800 mb-1 leading-tight">${employee.nama}</h2> 
                                
                                <!-- Bagian (Baru) -->
                                <p class="text-sm font-medium text-gray-600 mb-2">${employee.bagian || '-'}</p>

                                <!-- No. Absen (HANYA NOMOR SAJA) -->
                                <p class="text-gray-500 text-sm">${employee.noAbsen}</p>
                            </div>

                            <!-- KOLOM KANAN (DETAIL DATA - Format Tabel Rapi) -->
                            <div class="md:col-span-2 text-sm text-gray-700 w-full pt-2">
                                
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3">
                                    
                                    <!-- Status & Tgl Masuk (Pekerjaan) -->
                                    <div class="detail-row">
                                        <p class="detail-label">Status</p>
                                        <p class="detail-value">
                                             <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${employee.statusPekerjaan || '-'}</span>
                                        </p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Tanggal Masuk</p>
                                        <p class="detail-value">${employee.tglMasuk || '-'}</p>
                                    </div>
                                    
                                    <!-- TTL & Jenis Kelamin (Pribadi) -->
                                    <div class="detail-row">
                                        <p class="detail-label">Tempat, Tgl Lahir</p>
                                        <p class="detail-value">${employee.tptTglLahir || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Jenis Kelamin</p>
                                        <p class="detail-value">${employee.jenisKelamin || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Agama</p>
                                        <p class="detail-value">${employee.agama || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Pendidikan</p>
                                        <p class="detail-value">${employee.pendidikan || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Status Perkawinan</p>
                                        <p class="detail-value">${employee.statusKawin || '-'}</p>
                                    </div>
                                    
                                    <!-- Kontak -->
                                    <div class="detail-row">
                                        <p class="detail-label">No. WhatsApp</p>
                                        <p class="detail-value">${employee.noWa || '-'}</p>
                                    </div>
                                    
                                    <!-- Alamat (Baris Penuh) -->
                                    <div class="detail-row-full pt-2">
                                        <p class="detail-label mb-1">Alamat Lengkap:</p>
                                        <p class="detail-value text-left">${employee.alamat || '-'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Riwayat Permasalahan di modal admin -->
                        <div class="mt-6">
                            ${problemListHtml}
                        </div>
                    `;
                } catch (error) {
                     content.innerHTML = `<p class="text-red-500 text-center py-8">Gagal memuat detail: ${error.message}</p>`;
                }
            }

            // FUNGSI BARU: Tampilkan Modal Input Permasalahan
            async function showProblemInputModal(employeeId) {
                const modal = document.getElementById('problemInputModal');
                const title = document.getElementById('problemModalTitle');
                const info = document.getElementById('problemModalEmployeeInfo');
                const employeeIdField = document.getElementById('problemEmployeeId');
                const problemTypeSelect = document.getElementById('problemType');
                
                // 1. Reset Form dan Status
                document.getElementById('problemForm').reset();
                document.getElementById('problemStatus').classList.add('hidden');
                toggleProblemForm(''); // Sembunyikan semua input spesifik
                
                // 2. Ambil Data Karyawan
                try {
                    const { data: employee, error } = await supabase.from('karyawan').select('id, nama, noAbsen, bagian').eq('id', employeeId).single();
                    if (error) throw error;
                    
                    // 3. Update Modal Info
                    title.textContent = `Input Masalah untuk ${employee.nama}`;
                    info.innerHTML = `
                        <p class="font-semibold">${employee.nama} (${employee.noAbsen})</p>
                        <p class="text-sm">Bagian: ${employee.bagian}</p>
                    `;
                    employeeIdField.value = employee.id; // Simpan ID karyawan
                    
                    // 4. Tampilkan Modal
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    problemTypeSelect.focus();

                } catch (error) {
                    alert(`Gagal memuat data karyawan: ${error.message}`);
                }
            }

            // FUNGSI BARU: Sembunyikan Modal Input Permasalahan
            function hideProblemInputModal() {
                document.getElementById('problemInputModal').classList.add('hidden');
                document.getElementById('problemInputModal').classList.remove('flex');
            }

            // FUNGSI BARU: Mengganti Form SP/Potong Gaji secara dinamis
            function toggleProblemForm(type) {
                const spInputs = document.getElementById('spInputs');
                const potongGajiInputs = document.getElementById('potongGajiInputs');
                
                // Reset required attributes for safety
                const potongNominalInput = document.getElementById('potongNominal');
                document.getElementById('spDate').required = false;
                document.getElementById('spLevel').required = false;
                document.getElementById('spDetail').required = false;
                document.getElementById('potongDate').required = false;
                potongNominalInput.required = false; 
                document.getElementById('potongDetail').required = false;

                if (type === 'SP') {
                    spInputs.classList.remove('hidden');
                    potongGajiInputs.classList.add('hidden');
                    // Tambahkan atribut required
                    document.getElementById('spDate').required = true;
                    document.getElementById('spLevel').required = true;
                    document.getElementById('spDetail').required = true;
                } else if (type === 'Potong Gaji') {
                    potongGajiInputs.classList.remove('hidden');
                    spInputs.classList.add('hidden');
                    // Tambahkan atribut required
                    document.getElementById('potongDate').required = true;
                    potongNominalInput.required = true; // Nominal required
                    document.getElementById('potongDetail').required = true;
                } else {
                    spInputs.classList.add('hidden');
                    potongGajiInputs.classList.add('hidden');
                }
            }
            
            // FUNGSI BARU: Menyimpan Data Permasalahan (FIXED: Tombol, Rupiah, dan Supabase)
            async function saveEmployeeProblem(event) {
                event.preventDefault();
                const form = document.getElementById('problemForm');
                const employeeId = parseInt(document.getElementById('problemEmployeeId').value);
                const problemType = document.getElementById('problemType').value;
                const statusDiv = document.getElementById('problemStatus');
                const saveButton = document.getElementById('saveProblemButton');
                
                statusDiv.classList.add('hidden');
                
                // 1. Validasi Input (tanpa menonaktifkan tombol di sini)
                if (problemType === '') {
                    showProblemStatus('Harap pilih jenis permasalahan.', 'bg-red-100 text-red-700');
                    return;
                }
                
                let cleanNominal = null;
                let problemData = {};

                // Check specific fields based on type
                if (problemType === 'SP') {
                    if (!document.getElementById('spDate').value || !document.getElementById('spLevel').value || !document.getElementById('spDetail').value) {
                         showProblemStatus('Harap lengkapi semua data SP.', 'bg-red-100 text-red-700');
                         return;
                    }
                    problemData = {
                        employee_id: employeeId,
                        problem_type: problemType,
                        problem_date: document.getElementById('spDate').value,
                        problem_level: document.getElementById('spLevel').value,
                        detail: document.getElementById('spDetail').value,
                        nominal: null, // Pastikan kolom nominal null untuk SP
                    };
                } else if (problemType === 'Potong Gaji') {
                    const nominalValue = document.getElementById('potongNominal').value;
                    // Hapus titik dan koma, dan parse sebagai float
                    const cleanNominalString = nominalValue.replace(/\./g, '');
                    cleanNominal = parseFloat(cleanNominalString);
                    
                    if (!document.getElementById('potongDate').value || isNaN(cleanNominal) || cleanNominal <= 0 || !document.getElementById('potongDetail').value) {
                         showProblemStatus('Harap lengkapi Nominal Potong Gaji (angka positif) dan detail.', 'bg-red-100 text-red-700');
                         return;
                    }

                    problemData = {
                        employee_id: employeeId,
                        problem_type: problemType,
                        problem_date: document.getElementById('potongDate').value,
                        nominal: cleanNominal,
                        detail: document.getElementById('potongDetail').value,
                        problem_level: null, // Pastikan kolom level null untuk Potong Gaji
                    };
                }
                
                // 2. Proses Saving State
                saveButton.disabled = true; // Disable button here, as validation passed
                saveButton.textContent = 'Menyimpan...';

                // 3. Simpan Data ke Supabase
                try {
                    const { error } = await supabase.from('employee_problems').insert([problemData]);
                    if (error) throw error;

                    // 4. Beri Feedback Sukses
                    showProblemStatus(`Data ${problemType} berhasil disimpan ke database!`, 'bg-green-100 text-green-700');
                    
                    // 5. Tutup Modal dan Reset setelah 2 detik
                    setTimeout(() => {
                        hideProblemInputModal();
                        form.reset();
                        saveButton.disabled = false;
                        saveButton.textContent = 'Simpan Permasalahan';
                    }, 2000);

                } catch (error) {
                    console.error("Error saving problem:", error);
                    showProblemStatus(`Gagal menyimpan data: ${error.message}`, 'bg-red-100 text-red-700');
                    saveButton.disabled = false;
                    saveButton.textContent = 'Simpan Permasalahan';
                }
            }

            // FUNGSI BARU: Tampilkan Status Permasalahan
            function showProblemStatus(message, className) {
                const statusDiv = document.getElementById('problemStatus');
                statusDiv.textContent = message;
                statusDiv.className = `text-center p-3 rounded-lg mb-4 ${className}`;
                statusDiv.classList.remove('hidden');
            }


            // FUNGSI PENCARIAN KARYAWAN (UNTUK PENGGUNA)
            async function searchEmployee(event) {
                event.preventDefault();
                const searchName = document.getElementById('searchName').value.trim().toUpperCase();
                const resultsContainer = document.getElementById('searchResultContainer');

                if (!searchName) {
                    resultsContainer.innerHTML = '<p class="text-center text-yellow-600">Harap masukkan nama untuk mencari.</p>';
                    return;
                }
                
                resultsContainer.innerHTML = `<p class="text-center text-gray-500 py-4">Mencari...</p>`;

                try {
                    const { data, error } = await supabase.from('karyawan').select().ilike('nama', `%${searchName}%`);
                    if (error) throw error;
                    displaySearchResults(data);
                } catch (error) {
                     resultsContainer.innerHTML = `<p class="text-center text-red-600">Terjadi kesalahan: ${error.message}</p>`;
                }
            }

            // FUNGSI UNTUK MENAMPILKAN HASIL PENCARIAN (REVISI SUSUNAN DAN JARAK)
            async function displaySearchResults(results) { // Tambahkan 'async' di sini
                const resultsContainer = document.getElementById('searchResultContainer');
                
                if (!results || results.length === 0) {
                    resultsContainer.innerHTML = '<p class="text-center text-gray-500">Data karyawan tidak ditemukan.</p>';
                    return;
                }

                // Gunakan Promise.all untuk menunggu semua riwayat masalah dimuat
                const resultHtmlPromises = results.map(async employee => {
                    // --- MODIFIKASI: Ambil Riwayat Masalah ---
                    const problemListHtml = await renderProblemList(employee.id);

                    return `
                    <div class="border border-gray-200 rounded-xl p-6 shadow-2xl hover:shadow-3xl transition-shadow w-full">
                        
                        <!-- Kontainer Utama: Flex 2 Kolom (Kiri: Foto/Nama, Kanan: Detail Data) -->
                        <div class="flex flex-col sm:flex-row gap-6">
                            
                            <!-- KOLOM KIRI (FOTO, NAMA, BAGIAN, NO. ABSEN) -->
                            <div class="md:col-span-1 flex flex-col items-center text-center">
                                <img 
                                    src="${employee.fotoBase64 || 'https://placehold.co/150x150/eeeeee/333333?text=N/A'}" 
                                    alt="Foto ${employee.nama}" 
                                    class="w-32 h-32 rounded-full object-cover border-4 border-red-500 shadow-lg mb-4"
                                >
                                <div class="w-full">
                                    <!-- Nama Karyawan (1 Baris) -->
                                    <h3 class="text-xl font-bold text-gray-900 mb-1 leading-tight">${employee.nama}</h3>
                                    
                                    <!-- Bagian (Baru) -->
                                    <p class="text-sm font-medium text-gray-600 mb-2">${employee.bagian || '-'}</p>

                                    <!-- No. Absen (HANYA NOMOR SAJA) -->
                                    <p class="text-gray-500 text-sm">${employee.noAbsen}</p>
                                </div>
                            </div>

                            <!-- KOLOM KANAN (DETAIL DATA - Format Tabel Rapi) -->
                            <div class="w-full sm:w-2/3 text-sm text-gray-700 w-full pt-2">
                                
                                <div class="bg-white border border-gray-200 rounded-lg p-3">
                                    
                                    <!-- Status & Tgl Masuk (Pekerjaan) -->
                                    <div class="detail-row">
                                        <p class="detail-label">Status</p>
                                        <p class="detail-value">
                                             <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${employee.statusPekerjaan || '-'}</span>
                                        </p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Tanggal Masuk</p>
                                        <p class="detail-value">${employee.tglMasuk || '-'}</p>
                                    </div>
                                    
                                    <!-- TTL & Jenis Kelamin (Pribadi) -->
                                    <div class="detail-row">
                                        <p class="detail-label">Tempat, Tgl Lahir</p>
                                        <p class="detail-value">${employee.tptTglLahir || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Jenis Kelamin</p>
                                        <p class="detail-value">${employee.jenisKelamin || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Agama</p>
                                        <p class="detail-value">${employee.agama || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Pendidikan</p>
                                        <p class="detail-value">${employee.pendidikan || '-'}</p>
                                    </div>
                                    <div class="detail-row">
                                        <p class="detail-label">Status Perkawinan</p>
                                        <p class="detail-value">${employee.statusKawin || '-'}</p>
                                    </div>
                                    
                                    <!-- Kontak -->
                                    <div class="detail-row">
                                        <p class="detail-label">No. WhatsApp</p>
                                        <p class="detail-value">${employee.noWa || '-'}</p>
                                    </div>
                                    
                                    <!-- Alamat (Baris Penuh) -->
                                    <div class="detail-row-full pt-2">
                                        <p class="detail-label mb-1">Alamat Lengkap:</p>
                                        <p class="detail-value text-left">${employee.alamat || '-'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Riwayat Permasalahan di kartu pengguna -->
                        ${problemListHtml}

                    </div>
                `});

                const resultsHtml = await Promise.all(resultHtmlPromises);
                resultsContainer.innerHTML = resultsHtml.join('');
            }

            // FUNGSI UNTUK MENGHANDLE SUBMIT FORM KONTAK (SIMULASI)
            function handleContactSubmit(event) {
                event.preventDefault();
                const form = event.target;
                const button = form.querySelector('button[type="submit"]');
                button.disabled = true;
                button.textContent = 'Mengirim...';

                setTimeout(() => {
                    form.reset();
                    button.disabled = false;
                    button.textContent = 'Kirim';
                    // Menggunakan notifikasi custom, bukan alert
                    alert('Pesan Anda telah terkirim! (Ini adalah simulasi)');
                }, 1500);
            }

            // --- EVENT LISTENERS ---
            document.addEventListener('DOMContentLoaded', () => {
                // Inisialisasi Supabase
                initSupabase();
                // Tampilkan slide pertama dan mulai carousel saat halaman dimuat
                showSlides();
                startCarousel(); 

                // Tombol kembali sudah diatur visibilitasnya oleh logika showPage/toggleBackButton

                // Tombol di halaman update karyawan
                document.getElementById('showAddFormButton').addEventListener('click', () => {
                    document.getElementById('employeeListSection').classList.add('hidden');
                    document.getElementById('addEmployeeFormSection').classList.remove('hidden');
                    // Perbarui riwayat dan tombol
                    showPage('employeeInputPage-Form'); // Tambahkan state khusus untuk form input
                    // Panggil toggleBackButton untuk memastikan tombol kembali di halaman Form disembunyikan
                    toggleBackButton('employeeInputPage'); 
                });

                // REVISI: Tombol Batal akan menggunakan goBack() untuk kembali ke Data Karyawan Tersimpan
                document.getElementById('cancelAddFormButton').addEventListener('click', () => {
                    // Logika untuk menampilkan kembali list dan menyembunyikan form
                    document.getElementById('addEmployeeFormSection').classList.add('hidden');
                    document.getElementById('employeeListSection').classList.remove('hidden');
                    
                    // Cek jika halaman saat ini adalah state form, maka kita hapus dari riwayat
                    if (navHistory[navHistory.length - 1] === 'employeeInputPage-Form') {
                         navHistory.pop();
                    }
                    
                    // Panggil toggleBackButton untuk memastikan tombol kembali di atas halaman Data Karyawan Tersimpan terlihat
                    toggleBackButton('employeeInputPage');
                });
                
                // Event listener untuk modal
                const detailModal = document.getElementById('employeeDetailModal');
                document.getElementById('closeModalButton').addEventListener('click', () => detailModal.classList.add('hidden'));
                detailModal.addEventListener('click', (event) => {
                    if (event.target.id === 'employeeDetailModal') { // Hanya tutup jika klik di background
                        detailModal.classList.add('hidden');
                    }
                });
                
                // Burger Menu
                const menuButton = document.getElementById('menuButton');
                const navMenu = document.getElementById('navMenu');
                const iconMenu = document.getElementById('iconMenu');
                const iconClose = document.getElementById('iconClose');

                menuButton.addEventListener('click', () => {
                    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
                    navMenu.classList.toggle('hidden');
                    iconMenu.classList.toggle('hidden');
                    iconClose.classList.toggle('hidden');
                    menuButton.setAttribute('aria-expanded', !isExpanded);
                });

                // Klik di luar untuk menutup menu
                document.addEventListener('click', (event) => {
                    const burgerContainer = document.getElementById('burgerContainer');
                    if (burgerContainer && !burgerContainer.contains(event.target)) {
                         if (menuButton.getAttribute('aria-expanded') === 'true') {
                            menuButton.click();
                        }
                    }
                });
            });
            
            // Ekspor fungsi ke window object agar bisa diakses dari HTML
            window.showPage = showPage;
            window.goBack = goBack; // Export goBack
            window.handleAdminLogin = handleAdminLogin;
            window.handleLogout = handleLogout;
            window.showLogoutConfirmation = showLogoutConfirmation; // Export fungsi modal logout
            window.hideLogoutConfirmation = hideLogoutConfirmation; // Export fungsi modal logout
            window.saveEmployeeData = saveEmployeeData;
            window.previewImage = previewImage;
            window.showEmployeeDetailModal = showEmployeeDetailModal;
            window.searchEmployee = searchEmployee;
            window.handleContactSubmit = handleContactSubmit;
            // Ekspor fungsi delete baru
            window.toggleSelectAll = toggleSelectAll;
            window.toggleDeleteButton = toggleDeleteButton;
            window.showDeleteConfirmation = showDeleteConfirmation;
            window.hideDeleteConfirmation = hideDeleteConfirmation;
            window.deleteSelectedEmployees = deleteSelectedEmployees;
            // Ekspor fungsi carousel
            window.changeSlide = changeSlide;
            // Ekspor fungsi masalah karyawan
            window.showProblemInputModal = showProblemInputModal;
            window.hideProblemInputModal = hideProblemInputModal;
            window.toggleProblemForm = toggleProblemForm;
            window.saveEmployeeProblem = saveEmployeeProblem;
            window.formatRupiah = formatRupiah; // Export fungsi Rupiah
        </script>
        
    </div>

</body>
</html>
